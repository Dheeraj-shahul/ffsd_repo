<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worker Profile Update - RentEase</title>
  <link rel="stylesheet" href="/css/worker_register.css" />
  <style>
    body{
      padding-top:120px;
    }
    .page-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .registration-form-container {
      background: #fff; /* ✅ ORIGINAL WHITE */
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .form-section {
      margin-bottom: 20px;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    .form-group.full-width {
      flex: 100%;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #000; /* ✅ ORIGINAL BLACK */
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      color: #000; /* ✅ ORIGINAL BLACK */
    }
    .form-group input.error,
    .form-group select.error,
    .form-group textarea.error {
      border-color: red;
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    .primary-button {
      background-color: #ffc109; /* ✅ ORIGINAL GREEN */
      color: black;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .primary-button:hover {
      background-color: #218838; /* ✅ ORIGINAL GREEN */
    }
    .secondary-button {
      background-color: #6c757d; /* ✅ ORIGINAL GRAY */
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .secondary-button:hover {
      background-color: #5a6268; /* ✅ ORIGINAL GRAY */
    }
    
    /* ✅ FIXED CHECKBOX - ONLY THIS CHANGED */
    .agreement-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-top: 10px;
    }
    .agreement-checkbox input[type="checkbox"] {
      margin-top: 2px;
      width: 18px;
      height: 18px;
    }
    .agreement-checkbox label {
      margin: 0;
      line-height: 1.4;
      color: #000; /* ✅ ORIGINAL BLACK */
    }
    .agreement-checkbox a {
      color: #007bff; /* ✅ ORIGINAL BLUE LINK */
    }
  </style>
</head>
<body style="background: #f5f5f5;"> <!-- ✅ ORIGINAL GRAY BG -->
  <%- include('../partials/header') %>
  <div class="page-container">
    <div class="page-header">
      <h1 style="color: #000;">Worker Profile Update</h1> <!-- ✅ ORIGINAL BLACK -->
      <p style="color: #333;">Update your profile details below to manage your service on RentEase</p> <!-- ✅ ORIGINAL DARK GRAY -->
    </div>

    <div class="registration-form-container">
      <form id="worker-registration-form" enctype="multipart/form-data">
        <div class="form-section">
          <h2 style="color: #000;">Personal Information</h2> <!-- ✅ ORIGINAL BLACK -->
          <div class="form-row">
            <div class="form-group">
              <label for="full-name">Full Name*</label>
              <input
                type="text"
                id="full-name"
                name="full-name"
                required
                placeholder="Enter your full name"
                value="<%= user ? user.firstName + ' ' + user.lastName : '' %>"
              />
            </div>
            <div class="form-group">
              <label for="phone">Phone Number*</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                placeholder="10-digit mobile number"
                pattern="[0-9]{10}"
                value="<%= user ? user.phone : '' %>"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email Address*</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="Enter your email address"
                value="<%= user ? user.email : '' %>"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2 style="color: #000;">Service Details</h2> <!-- ✅ ORIGINAL BLACK -->
          <div class="form-row">
            <div class="form-group">
              <label for="service-type">Service Type*</label>
              <select id="service-type" name="service-type" required>
                <option value="" <%= !user || !user.serviceType ? 'selected' : '' %>>Select Service Type</option>
                <option value="Housekeeper" <%= user && user.serviceType === 'Housekeeper' ? 'selected' : '' %>>Housekeeper</option>
                <option value="Cook" <%= user && user.serviceType === 'Cook' ? 'selected' : '' %>>Cook</option>
                <option value="Nanny" <%= user && user.serviceType === 'Nanny' ? 'selected' : '' %>>Nanny</option>
                <!-- <option value="Driver" <%= user && user.serviceType === 'Driver' ? 'selected' : '' %>>Driver</option> -->
                <option value="Gardener" <%= user && user.serviceType === 'Gardener' ? 'selected' : '' %>>Gardener</option>
              </select>
            </div>
            <div class="form-group">
              <label for="experience">Years of Experience*</label>
              <input
                type="number"
                id="experience"
                name="experience"
                required
                min="0"
                max="50"
                value="<%= user ? user.experience : '' %>"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label for="description">Skills & Expertise*</label>
              <textarea
                id="description"
                name="description"
                rows="3"
                required
                placeholder="Describe your skills and expertise"
              ><%= user ? user.description : '' %></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="price">Expected Monthly Salary (₹)*</label>
              <input
                type="number"
                id="price"
                name="price"
                required
                min="1000"
                value="<%= user ? user.price : '' %>"
              />
            </div>
            <div class="form-group">
              <label for="availability">Availability*</label>
              <select id="availability" name="availability" required>
                <option value="" <%= !user || !user.availability ? 'selected' : '' %>>Select Availability</option>
                <option value="full-time" <%= user && user.availability === 'full-time' ? 'selected' : '' %>>Full Time</option>
                <option value="part-time" <%= user && user.availability === 'part-time' ? 'selected' : '' %>>Part Time</option>
                <option value="weekends" <%= user && user.availability === 'weekends' ? 'selected' : '' %>>Weekends Only</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2 style="color: #000;">Location Details</h2> <!-- ✅ ORIGINAL BLACK -->
          <div class="form-row">
            <div class="form-group">
              <label for="city">City*</label>
              <select id="city" name="city" required onchange="updateAreas()">
                <option value="" <%= !user || !user.city ? 'selected' : '' %>>Select City</option>
                <option value="delhi" <%= user && user.city === 'delhi' ? 'selected' : '' %>>Delhi</option>
                <option value="mumbai" <%= user && user.city === 'mumbai' ? 'selected' : '' %>>Mumbai</option>
                <option value="bangalore" <%= user && user.city === 'bangalore' ? 'selected' : '' %>>Bangalore</option>
                <option value="chennai" <%= user && user.city === 'chennai' ? 'selected' : '' %>>Chennai</option>
                <option value="sricity" <%= user && user.city === 'sricity' ? 'selected' : '' %>>Sricity</option>
              </select>
            </div>
            <div class="form-group">
              <label for="area">Preferred Area*</label>
              <select id="area" name="area" required>
                <option value="" <%= !user || !user.area ? 'selected' : '' %>>Select Area</option>
                <% if (user && user.area) { %>
                  <option value="<%= user.area %>" selected><%= user.area.charAt(0).toUpperCase() + user.area.slice(1) %></option>
                <% } %>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2 style="color: #000;">Documents</h2> <!-- ✅ ORIGINAL BLACK -->
          <div class="form-row">
            <div class="form-group">
              <label for="image">Recent Photo*</label>
              <input
                type="file"
                id="image"
                name="image"
                accept="image/*"
              />
              <% if (user && user.image) { %>
                <p style="color: #333;">Current Photo: <a href="<%= user.image %>" target="_blank" style="color: #007bff;">View</a></p> <!-- ✅ ORIGINAL COLORS -->
              <% } %>
            </div>
          </div>
        </div>

        <!-- ✅ FIXED CHECKBOX SECTION -->
        <div class="form-section">
          <div class="form-group full-width">
            <div class="agreement-checkbox">
              <input
                type="checkbox"
                id="terms-agreement"
                name="terms-agreement"
                required
              />
              <label for="terms-agreement">
                I agree to RentEase's
                <a href="/termsofservice">Terms & Conditions</a> and
                <a href="/privacy_policy">Privacy Policy</a>*
              </label>
            </div>
          </div>
        </div>

        <input type="hidden" name="service-type" value="<%= user && user.serviceType ? user.serviceType : '' %>">

        <div class="form-actions">
          <button type="button" class="secondary-button" onclick="resetForm()">
            Clear All
          </button>
          <button type="submit" class="primary-button">
            Update Profile
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Area data
    const areasByCity = {
      delhi: ["karol bagh", "connaught place", "dwarka", "rohini"],
      mumbai: ["andheri", "bandra", "juhu", "colaba"],
      bangalore: ["koramangala", "indiranagar", "whitefield", "jp nagar"],
      chennai: ["t nagar", "anna nagar", "adyar", "mylapore"],
      sricity: ["central", "north", "south"]
    };

    // Update areas based on selected city
    function updateAreas() {
      const citySelect = document.getElementById("city");
      const areaSelect = document.getElementById("area");
      const selectedCity = citySelect.value;

      // Reset area dropdown
      areaSelect.innerHTML = '<option value="">Select Area</option>';

      if (!selectedCity) {
        areaSelect.disabled = true;
        return;
      }

      // Enable and populate area dropdown
      areaSelect.disabled = false;
      const areas = areasByCity[selectedCity] || [];

      areas.forEach((area) => {
        const option = document.createElement("option");
        option.value = area;
        option.textContent = area.charAt(0).toUpperCase() + area.slice(1);
        areaSelect.appendChild(option);
      });

      // Pre-select area if available
      <% if (user && user.area) { %>
        const areaOption = Array.from(areaSelect.options).find(option => option.value === "<%= user.area %>");
        if (areaOption) {
          areaSelect.value = "<%= user.area %>";
        }
      <% } %>
    }

    // Reset form
    function resetForm() {
      document.getElementById("worker-registration-form").reset();
      document.getElementById("area").innerHTML = '<option value="">Select Area</option>';
      document.getElementById("area").disabled = true;
    }

    // Initialize area dropdown on page load
    window.onload = function() {
      <% if (user && user.city) { %>
        updateAreas();
      <% } %>
    };

    // Form submission
    document.getElementById("worker-registration-form").addEventListener("submit", function (event) {
      event.preventDefault();

      // Validate form
      const requiredFields = document.querySelectorAll("[required]");
      let isValid = true;

      requiredFields.forEach((field) => {
        if (!field.value || (field.type === "checkbox" && !field.checked)) {
          isValid = false;
          field.classList.add("error");
        } else {
          field.classList.remove("error");
        }
      });

      if (!isValid) {
        alert("Please fill in all required fields marked with *");
        return;
      }

      // Submit form via AJAX
      const form = document.getElementById("worker-registration-form");
      const formData = new FormData(form);

      fetch("/api/workers/register", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert("Profile updated successfully! Redirecting to dashboard.");
            window.location.href = "/worker_dashboard";
          } else {
            alert("Error updating profile: " + data.error);
          }
        })
        .catch((error) => {
          alert("Error updating profile: " + error.message);
        });
    });
  </script>
</body>
</html>